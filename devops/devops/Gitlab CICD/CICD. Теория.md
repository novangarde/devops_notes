
## Синтаксис

Синтаксис GitLab CI/CD основан на файле `.gitlab-ci.yml`, который описывает все этапы сборки, тестирования и развертывания проекта. Этот файл использует формат YAML для определения пайплайна. Вот основные элементы синтаксиса:

**Stages**: Определяет этапы пайплайна (например, сборка, тестирование, развертывание).

```YAML
stages:
  - build
  - test
  - deploy
```

**Jobs**: Задачи, которые выполняются на каждом этапе. Каждая задача может содержать несколько шагов. И в каждом этапе (к примеру, build) может быть несколько **jobs**.

```YAML
build_job:
  stage: build
  script:
    - echo "Building..."
```

**Script**: Шаги, которые выполняются внутри задачи.

```YAML
test_job:
  stage: test
  script:
    - echo "Testing..."
    - make test
```

**Rules**: Условия, при которых задача будет выполняться.

```YAML
deploy_job:
  stage: deploy
  script:
    - echo "Deploying..."
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
```

**Variables**: Переменные, которые можно использовать в пайплайне.

```YAML
variables:
  MY_VAR: "some_value"
```

**Services**: Дополнительные контейнеры, которые запускаются вместе с задачей (например, база данных).

```YAML
services:
  - postgres
```

**Tags**: Метки, которые используются для выбора runner'ов.

```YAML
tags:
  - docker
```

**Image**: Образ Docker, в котором выполняется задача.

```YAML
image: node:latest
```

### Пример

```YAML
stages:
  - build
  - test
  - deploy

variables:
  MY_VAR: "some_value"

build_job:
  stage: build
  image: node:latest
  script:
    - echo "Building..."
    - npm install

test_job:
  stage: test
  image: node:latest
  script:
    - echo "Testing..."
    - npm run test

deploy_job:
  stage: deploy
  script:
    - echo "Deploying..."
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
```


## Экзекьюторы

**Экзекьюторы GitLab Runner** — это механизмы, которые выполняют задачи CI/CD в различных средах. Они определяют, как и где будут запускаться ваши скрипты и пайплайны.

Типы экзекьюторов:

1. **Docker**: Запускает задачи внутри контейнеров Docker. Это позволяет изолировать среду выполнения и использовать различные образы для разных задач.
2. **Shell**: Выполняет задачи напрямую на хосте, где запущен GitLab Runner. Это простой и быстрый способ запуска скриптов, но требует наличия всех необходимых инструментов на хосте.
3. **SSH**: Использует SSH для подключения к удаленному серверу и выполнения задач на нем. Это полезно для развертывания на удаленные серверы.
4. **Parallels**: Использует виртуальные машины Parallels для выполнения задач. Этот экзекьютор менее распространен и больше ориентирован на пользователей macOS.
5. **VirtualBox**: Аналогично Parallels, использует виртуальные машины VirtualBox для выполнения задач.
6. **Docker**
7. **Custom**

## Этапы CI

CI (Continuous Integration) — это часть CI/CD-пайплайна, которая включает в себя непрерывную интеграцию кода. Основные этапы CI:

* **Build:** код собирается и компилируется в исполняемый формат. Это может включать создание двоичных файлов или образов контейнеров.
* **Test:** ключает в себя автоматизированное тестирование кода, чтобы убедиться, что он работает правильно.

## Этапы CD

* **Release**: это часть процесса, на которой готовая версия программного обеспечения подготовлена для развертывания в продакшн. Однако в контексте CD термин **release** может быть несколько двусмысленным, поскольку он часто ассоциируется с финальным шагом перед развертыванием.
* **Deploy Production**: Это этап, на котором готовая версия приложения развертывается на продакшн-серверах, где она становится доступна конечным пользователям.
* **Update Configs**: Этот этап включает в себя обновление конфигураций окружения, таких как настройки серверов, баз данных или других компонентов системы. Это необходимо для того, чтобы обеспечить совместимость новой версии приложения с существующей инфраструктурой.

Другие этапы, которые могут быть частью CD:

* **Staging (Тестирование на стейджинг-сервере)**: Перед развертыванием в продакшн, приложение часто развертывается на стейджинг-сервере для дополнительного тестирования в более реалистичной среде.
- **Canary Releases (Канареечные релизы)**: Это метод постепенного развертывания новой версии приложения для небольшой части пользователей, чтобы проверить ее стабильность и производительность.
- **Rollback (Откат)**: Если после развертывания новой версии обнаруживаются критические ошибки, может быть выполнен откат на предыдущую стабильную версию.
- **Monitoring (Мониторинг)**: После развертывания приложения, важно постоянно отслеживать его производительность и стабильность, чтобы быстро выявлять и исправлять проблемы.

